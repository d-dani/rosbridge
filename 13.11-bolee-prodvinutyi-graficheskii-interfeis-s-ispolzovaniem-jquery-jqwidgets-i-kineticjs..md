# Подглава 13.11 Продвинутый графический интерфейс с использованием jQuery, jqWidgets и KineticJS.

Мы можем создать более удобный графический интерфейс для нашего робота, используя некоторые современные библиотеки HTML5, включая jQuery, jqWidgets и KineticJS. Эти библиотеки предоставляют функции для создания макетов с вкладками, многослойных панелей и пользовательских элементов управления, более подходящих для сенсорных экранов. Хотя мы не будем подробно останавливаться на этом более продвинутом графическом интерфейсе, этот код относительно прост, если вы знаете, как использовать эти наборы инструментов. Для учебников и документации для самих наборов инструментов, смотрите ссылки выше. 

Новый графический интерфейс определяется файлом HTML robot\_gui.html в пакете rbx2\_gui и файлом Javascript robot\_gui.js в каталоге rbx2\_gui/js. Также есть небольшое количество стилей, установленных в файле styles/robot\_gui.css. Файл robot\_gui.html определяет количество вкладок \(несколько перекрывающихся экранов\), которые определяются отдельными файлами в каталоге rbx2\_gui/tabs. Таким образом, наш графический интерфейс \(GUI\) состоит из следующих каталогов и файлов: 

* /rbx2\_gui  
* robot\_gui.hjtml  
* /tabs  
* main.html  
* navigation.html  
* diagnostics.html  
* parameters.html  
* misc.html  
* /js  
* robot\_gui.js  
* styles  
* robot\_gui.css 

Чтобы проверить это, сначала убедитесь, что у вас работает узел камеры: 

`$ roslaunch rbx2_video openni_node.launch`

\(Или используйте файл uvc\_cam.launch, если вы используете веб-камеру.\) 

Затем запустите файл rosbridge.launch, если он еще не запущен: 

`$ roslaunch rbx2_gui rosbridge.launch`

\(Обратите внимание, что мы используем тот же лаунч файл rosbridge, что и раньше, но теперь мы укажем нашему браузеру на другую веб-страницу. Это позволяет нам использовать разные графические интерфейсы для одного сервера rosbridge.\) 

Теперь укажите вашему браузеру следующий URL: 

[http://localhost:8181/robot\_gui.html](http://localhost:8181/robot_gui.html) 

\(Измените номер порта, если вы не смогли использовать порт 8181 для веб-сервера mini-httpd.\) Окно вашего браузера должно выглядеть примерно так: 

![](.gitbook/assets/image%20%282%29.png)

Вкладки расположены сверху - щелкните или коснитесь ярлыка вкладки, чтобы переключиться на соответствующий экран. В настоящее время только вкладки Main \(Главная\), Navigation \(Навигация\) и Misc \(Разное\) имеют какую-либо функцию – вкладки Diagnostics \(Диагностика\) и Parameters \(Параметры\) являются просто макетами, которые служат дополнительными примерами. Эти вкладки создаются с помощью инструментария jqWidgets, а код можно найти в файле robot\_gui.html. 

На вкладке Main \(Главная\) стрелки базового элемента управления были заменены имитируемой сенсорной панелью \(синего цвета\), аналогичной базовому элементу управления, предоставленному графическим интерфейсом ArbotiX, который мы использовали ранее в книге. Сенсорная панель создается с помощью инструментария KineticJS, а код находится в файле robot\_gui.js. Перетащите желтый диск мышью или пальцем \(на сенсорном экране\) и переместите его в направлении, в котором вы хотите, чтобы робот двигался. Чем дальше от центра вы перемещаете диск, тем быстрее будет двигаться робот. Отпустите диск, и робот остановится. Панель управления расположена таким образом, что, если вы держите планшет, желтый диск должен хорошо ложиться под ваш большой палец для управления основанием. 

Максимальные линейные и угловые скорости можно регулировать с помощью ползунков под сенсорной панелью. 

Уровень заряда аккумулятора робота и аккумулятора ноутбука \(если он работает на ноутбуке\) отображается с помощью пары указателей уровня топлива jqWidgets, определенных в файле tabs/main.html. 

Подписка на соответствующие топики уровня заряда батареи осуществляется в файле robot\_gui.js, и должна быть настроена для вашего робота. Мы будем использовать симулятор батареи, чтобы проверить их ниже. 

Вкладка Misc \(Разное\) содержит тот же код, который мы использовали с простым графическим интерфейсом, и показана ниже 

![](.gitbook/assets/image%20%283%29.png)

Вкладки Diagnostics \(Диагностика\) и Parameters \(Параметры\) в настоящее время являются просто макетами, определенными файлами tabs/Diagnics.html и tabs/parameters.html. Отредактируйте эти файлы, добавив свой собственный код или вообще удалите вкладки, отредактировав файл robot\_gui.html. На данный момент на страницах просто отображается следующее сообщение: 

![](.gitbook/assets/image%20%284%29.png)

Прежде чем описывать вкладку Navigation \(Навигация\), давайте запустим fake TurtleBot, используя тестовую карту, найденную в rbx2\_nav/maps. \(Это та же карта, которую мы использовали для смоделированного навигационного теста в томе 1\). Мы также установим время автономной работы батареи на 15 минут \(900 секунд\). Запустите файл fake\_turtlebot.launch из пакета rbx2\_tasks, используя аргумент battery\_runtime и аргумент map следующим образом: 

`$ roslaunch rbx2_tasks fake_turtlebot.launch battery_runtime:=900 map:=test_map.yaml`

При работающем fake узле батареи указатель уровня топлива батареи робота в rosbridge GUI должен начать падать со 100 до 0 в течение 15 минут. 

Затем откройте RViz, чтобы мы могли убедиться, что карта загружена и fake TurtleBot можно увидеть на карте. 

`$ rosrun rviz rviz -d rospack find rbx2_gui/nav.rviz`

Представление в RViz должно выглядеть примерно так: 

![](.gitbook/assets/image%20%285%29.png)

Наконец, вернитесь в графический интерфейс rosbridge в своем веб-браузере и нажмите на вкладку Navigation \(Навигация\). Вы должны увидеть карту, которая выглядит примерно так: 

![](.gitbook/assets/image%20%286%29.png)

Маленький оранжевый треугольник представляет положение и ориентацию робота. Чтобы отправить робота на новое место, кликните или нажмите на местоположение цели на карте. Если вы используете мышь \(не сенсорный экран\), вы также можете нажать и удерживать, а затем установить ориентацию, как это можно сделать в RViz. \(На сенсорном экране в настоящее время может быть задана только целевая позиция.\) После установки нового местоположения цели маркер робота должен перемещаться по карте в окне вашего браузера, в то время как fake TurtleBot следует по тому же пути в RViz. 

ПРИМЕЧАНИЕ. Используемая здесь функция навигации зависит от пакета nav2djs. Текущая версия этого пакета содержит ошибку, из-за которой карта смещается во viewer на величину, равную смещению ее начала. Версия файла nav2d.js, находящаяся в каталоге rbx2\_gui/js, была настроена для исправления этой ошибки. 

